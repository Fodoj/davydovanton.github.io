<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="fikys.github.io : " />

    <link rel="stylesheet" type="text/css" media="screen" href="../../stylesheets/stylesheet.css">

    <title>Seed файл и вы</title>
  </head>

  <body>

    <div class="yandex_metrica">
      <!-- Yandex.Metrika counter --><script type="text/javascript">var yaParams = {/*Здесь параметры визита*/};</script><script type="text/javascript">(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter23652886 = new Ya.Metrika({id:23652886, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true, trackHash:true,params:window.yaParams||{ }}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src="//mc.yandex.ru/watch/23652886" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    </div>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <!-- <a id="forkme_banner" href="https://github.com/fikys">View on GitHub</a> -->

          <a href="/"><h1 id="project_title">Seed файл и вы</h1></a>
          <h2 id="project_tagline"></h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

        <ol>
<li>Введение, описание проблеммы, расказ про веселье</li>
<li>разбираем задачу</li>
<li>чем пользуемся</li>
<li>Пишем</li>
<li>Что можно добавить</li>
<li>вывод</li>
</ol>


<p>Совсем не давно на работе потребовалось заполнить совсем новый проект данными для дальнейшего тестирования и разработки. Конечно же, данные должны просто быть и первое, о чем я подумал, был seed файл, поэтому сегодня мы поговорим именно о нем. Как всем известно данный файл служит для генерации данных в рельсовых приложениях. Вы пишите скрипт, выполняете <code>rake db:seed</code> и радуетесь жизни. В моем случае данные были типовыми, а именно, нужно было сгенерировать: пользователей, посты и комментарии к этим постам. Я думаю все прекрасно понимают, как все взаимосвязанно, поэтому на этом останавливаться не вижу особого смысла.</p>

<p>Обычная практика многих людей - задать одинаковые данные для всех типов данных и наплодить их с десяток. Смотрится это обычно как-то так:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">user</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nb">name</span><span class="p">:</span>  <span class="s1">&#39;Jon&#39;</span>
  <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;my@email.org&#39;</span>
  <span class="ss">password</span><span class="p">:</span> <span class="s1">&#39;12345678&#39;</span><span class="p">,</span>
  <span class="n">password_confirmation</span><span class="p">:</span> <span class="s1">&#39;12345678&#39;</span>  
  <span class="p">}</span>

<span class="n">post</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">title</span><span class="p">:</span>  <span class="s1">&#39;My Post&#39;</span>
  <span class="ss">body</span><span class="p">:</span>   <span class="s1">&#39;My body&#39;</span>
  <span class="p">}</span>

<span class="n">comment</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">body</span><span class="p">:</span> <span class="s1">&#39;comment&#39;</span> <span class="p">}</span>

<span class="mi">10</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
  <span class="n">my_user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
  <span class="n">my_post</span> <span class="o">=</span> <span class="n">my_user</span><span class="o">.</span><span class="n">create_post</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
  <span class="n">my_post</span><span class="o">.</span><span class="n">create_comment</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>


<p>Но согласитесь, это скучно, банально и задевает чувство прекрасного. Поэтому давайте плюнем на все, и развлечемся создав свой собственный, изменяющийся из раза в раз мир :)</p>

<p>АТЕНШЕН(!!!исправить!!!): далее будет много рандома, благодаря которому поддерживать все это или искать ошибки становиться все сложнее и сложнее. Поэтому, использование генераторов основанных на рандоме не рекомендуется для продакшена. В крайнем случае использовать аккуратно и с умом.</p>

<p>Для того, что бы наш мир существовал, нам нужны люди. Наша цель - создать абсолютно разных пользователей, не похожих друг на друга. Конечно же, первое, что всплывает в голову - замечательный гем <a href="https://github.com/stympy/faker">faker</a> который поможет нам генерировать произвольные имена и почтовые адресса для наших пользователей. Но при всем при этом, не будем забывать про нашего админа. Так же, давайте зададим рандомное количество пользователей в интервале от 18 до 25(числа, как вы догадались, могут быть абсолютно любые):</p>

<div class="highlight"><pre><code class="ruby"><span class="n">user</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nb">name</span><span class="p">:</span>  <span class="n">admin</span>
  <span class="ss">email</span><span class="p">:</span> <span class="n">admin</span><span class="vi">@my_app</span><span class="o">.</span><span class="n">com</span>
  <span class="ss">password</span><span class="p">:</span> <span class="s1">&#39;12345678&#39;</span><span class="p">,</span>
  <span class="n">password_confirmation</span><span class="p">:</span> <span class="s1">&#39;12345678&#39;</span>  
  <span class="p">}</span>

<span class="n">rnd</span> <span class="o">=</span> <span class="no">Random</span><span class="o">.</span><span class="n">new</span>
<span class="n">user_count</span> <span class="o">=</span> <span class="n">rnd</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">18</span><span class="o">.</span><span class="n">.</span><span class="mi">23</span><span class="p">)</span>
<span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

<span class="n">user_count</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
  <span class="n">user</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>  <span class="o">=</span> <span class="ss">Faker</span><span class="p">:</span><span class="ss">:Name</span><span class="o">.</span><span class="n">name</span>
  <span class="n">user</span><span class="o">[</span><span class="ss">:email</span><span class="o">]</span> <span class="o">=</span> <span class="ss">Faker</span><span class="p">:</span><span class="ss">:Internet</span><span class="o">.</span><span class="n">email</span>  
  <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>


<p>Cобственно я уверен, faker поможет вам сгенерировать почти любую информацию, стоит только открыть доки. Ну а если вам не угодил faker, то существует достаточно <a href="https://www.ruby-toolbox.com/categories/random_data_generation">много</a> других data генераторов.</p>

<p>Не думаю, что тут что-то было сложно, поэтому пререйдем к постам. Сказать по правде, в нашем проекте посты состояли из строго заданных кусков html-a поэтому тут ничего не оставалось, кроме как делать в лоб. Единственный момент, мы будем выбирать произвольно польователя, что бы от его имени создавать наш пост:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">posts</span> <span class="o">=</span> <span class="o">[</span>
  <span class="p">{</span>
    <span class="ss">title</span><span class="p">:</span>  <span class="s1">&#39;My first Post&#39;</span>
    <span class="ss">body</span><span class="p">:</span>   <span class="s1">&#39;My body&#39;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="ss">title</span><span class="p">:</span>  <span class="s1">&#39;My second Post&#39;</span>
    <span class="ss">body</span><span class="p">:</span>   <span class="s1">&#39;My body&#39;</span>    
  <span class="p">},</span>
  <span class="c1"># Еще какое-то количество данных для постов ...</span>
<span class="o">]</span>

<span class="k">def</span> <span class="nf">rnd_user</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">rnd</span><span class="p">)</span>
  <span class="n">random_user_id</span> <span class="o">=</span> <span class="n">rnd</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
  <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">random_user_id</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">posts</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span>
  <span class="n">rand_user</span> <span class="o">=</span> <span class="n">rnd_user</span> <span class="n">user_count</span><span class="p">,</span> <span class="n">rnd</span>

  <span class="n">post</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">rand_user</span><span class="o">.</span><span class="n">id</span>
  <span class="n">created_post</span> <span class="o">=</span> <span class="n">rand_user</span><span class="o">.</span><span class="n">create_post</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>





        <br><hr>

        <div class="share_buttons">
          <p>Рассказать друзьям:</p>
          <!-- AddThis Button BEGIN -->
          <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
          <a class="addthis_button_twitter"></a>
          <a class="addthis_button_facebook"></a>
          <a class="addthis_button_vk"></a>
          <a class="addthis_button_livejournal"></a>
          <a class="addthis_button_google_plusone_share"></a>
          <a class="addthis_button_tumblr"></a>
          <a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
          </div>
          <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51d703f164d65d92"></script>
          <!-- AddThis Button END -->
        </div>

        <p><a href="/blog"><b>Назад</b></a></p>
      </section>

      <div class="comments">
        <div id="disqus_thread"></div>
          <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'fikysmyblog'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Hosted by <a href="http://pages.github.com">GitHub</a></p>
      </footer>
    </div>

    

  </body>
</html>
